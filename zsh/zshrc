#
# Executes commands at the start of an interactive session.
#
#

#
# Set the list of directories that Zsh searches for programs.
#
fpath=(
  $DOTFILES/zsh/functions
  $fpath
)

typeset -gU fpath

#
# Source Prezto.
#
if [[ -s "${ZDOTDIR}/prezto/init.zsh" ]]; then
  source "${ZDOTDIR}/prezto/init.zsh"
fi

#
# Git
#
# Revive old gst alias from OMZ/git
alias gst="git status"

# git update fork
# Merge upstream
function gupf {
    (
    set -e
    local ORIGIN=${1-origin}
    local UPSTREAM=${2-upstream}
    local LBRANCH=`git symbolic-ref --short HEAD`
    local OBRANCH=${3-$LBRANCH}
    local UBRANCH=${4-$OBRANCH}
    git fetch $ORIGIN
    git fetch $UPSTREAM
    git checkout $ORIGIN/$OBRANCH
    git checkout -b merge
    git merge $UPSTREAM/$UBRANCH -m "merge upstream from `git ls-remote --get-url $UPSTREAM`"
    git checkout $LBRANCH
    git rebase merge
    git branch -d merge
    )
}

#
# SSH
#
if (( $+commands[systemctl] )); then
    eval "$(systemctl --user show-environment | grep '^SSH_AUTH_SOCK=')"
fi
if [ -n $SSH_AUTH_SOCK -a -f "$XDG_RUNTIME_DIR/ssh-agent.sock" ]; then
    SSH_AUTH_SOCK="$XDG_RUNTIME_DIR/ssh-agent.sock"
fi
export SSH_AUTH_SOCK

#
# rsync
#
alias rsync="rsync -aXzPvihs -e ssh"

#
# Local overrides
#
[[ -e "$DOTFILES/zsh/zshrc.local" ]] && source "$DOTFILES/zsh/zshrc.local"

